<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Marży - Gadżety Reklamowe</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function MarginCalculator() {
            const [products, setProducts] = useState([
                { id: 1, name: '', purchaseCost: '', customizationCost: '', shippingCost: '', targetMargin: 40 }
            ]);

            const addProduct = () => {
                setProducts([...products, {
                    id: Date.now(),
                    name: '',
                    purchaseCost: '',
                    customizationCost: '',
                    shippingCost: '',
                    targetMargin: 40
                }]);
            };

            const removeProduct = (id) => {
                if (products.length > 1) {
                    setProducts(products.filter(p => p.id !== id));
                }
            };

            const updateProduct = (id, field, value) => {
                setProducts(products.map(p => 
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const calculateResults = (product) => {
                const purchase = parseFloat(product.purchaseCost) || 0;
                const customization = parseFloat(product.customizationCost) || 0;
                const shipping = parseFloat(product.shippingCost) || 0;
                const margin = parseFloat(product.targetMargin) || 0;

                const totalCost = purchase + customization + shipping;
                const sellingPrice = margin > 0 && margin < 100 
                    ? totalCost / (1 - margin / 100) 
                    : totalCost;
                const profit = sellingPrice - totalCost;
                const multiplier = totalCost > 0 ? sellingPrice / totalCost : 0;
                const markup = totalCost > 0 ? ((sellingPrice - totalCost) / totalCost) * 100 : 0;

                return {
                    totalCost,
                    sellingPrice,
                    profit,
                    multiplier,
                    markup
                };
            };

            const exportToCSV = () => {
                const headers = [
                    'Nazwa produktu',
                    'Koszt zakupu (zł)',
                    'Koszt personalizacji (zł)',
                    'Koszt wysyłki (zł)',
                    'Koszty całkowite (zł)',
                    'Docelowa marża (%)',
                    'Cena sprzedaży (zł)',
                    'Zysk (zł)',
                    'Mnożnik',
                    'Narzut (%)'
                ];

                const rows = products.map(product => {
                    const results = calculateResults(product);
                    return [
                        product.name || 'Bez nazwy',
                        product.purchaseCost || '0',
                        product.customizationCost || '0',
                        product.shippingCost || '0',
                        results.totalCost.toFixed(2),
                        product.targetMargin,
                        results.sellingPrice.toFixed(2),
                        results.profit.toFixed(2),
                        results.multiplier.toFixed(2),
                        results.markup.toFixed(2)
                    ];
                });

                const csvContent = [
                    headers.join(';'),
                    ...rows.map(row => row.join(';'))
                ].join('\n');

                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `kalkulator_marzy_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            };

            const presetMargins = [
                { label: 'Gadżety reklamowe', value: 35 },
                { label: 'Produkty premium', value: 50 },
                { label: 'Odzież firmowa', value: 40 },
                { label: 'Niestandardowa', value: 0 }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="bg-indigo-600 p-3 rounded-xl">
                                    <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800">Kalkulator Marży</h1>
                                    <p className="text-gray-600">Oblicz cenę sprzedaży na podstawie docelowej marży</p>
                                </div>
                            </div>

                            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
                                <div className="flex items-start gap-2">
                                    <svg className="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                    </svg>
                                    <div className="text-sm text-blue-800">
                                        <strong>Formuła:</strong> Cena sprzedaży = Koszty całkowite / (1 - Marża% / 100)
                                        <br />
                                        <strong>Przykład:</strong> Koszty 100 zł, marża 40% → Cena = 100 / 0.6 = 166,67 zł
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-6">
                                {products.map((product, index) => {
                                    const results = calculateResults(product);

                                    return (
                                        <div key={product.id} className="border border-gray-200 rounded-xl p-6 bg-gray-50">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-lg font-semibold text-gray-700">
                                                    Produkt {index + 1}
                                                </h3>
                                                {products.length > 1 && (
                                                    <button
                                                        onClick={() => removeProduct(product.id)}
                                                        className="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors"
                                                    >
                                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                        </svg>
                                                    </button>
                                                )}
                                            </div>

                                            <div className="grid md:grid-cols-2 gap-4 mb-4">
                                                <div className="md:col-span-2">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Nazwa produktu
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={product.name}
                                                        onChange={(e) => updateProduct(product.id, 'name', e.target.value)}
                                                        placeholder="np. Kubek ceramiczny z logo"
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Koszt zakupu (zł)
                                                    </label>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={product.purchaseCost}
                                                        onChange={(e) => updateProduct(product.id, 'purchaseCost', e.target.value)}
                                                        placeholder="0.00"
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Koszt personalizacji (zł)
                                                    </label>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={product.customizationCost}
                                                        onChange={(e) => updateProduct(product.id, 'customizationCost', e.target.value)}
                                                        placeholder="0.00"
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Koszt wysyłki (zł)
                                                    </label>
                                                    <input
                                                        type="number"
                                                        step="0.01"
                                                        value={product.shippingCost}
                                                        onChange={(e) => updateProduct(product.id, 'shippingCost', e.target.value)}
                                                        placeholder="0.00"
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Docelowa marża (%)
                                                    </label>
                                                    <input
                                                        type="number"
                                                        step="1"
                                                        min="0"
                                                        max="99"
                                                        value={product.targetMargin}
                                                        onChange={(e) => updateProduct(product.id, 'targetMargin', e.target.value)}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                    />
                                                    <div className="flex gap-2 mt-2 flex-wrap">
                                                        {presetMargins.map(preset => (
                                                            <button
                                                                key={preset.label}
                                                                onClick={() => updateProduct(product.id, 'targetMargin', preset.value)}
                                                                className="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full hover:bg-indigo-200 transition-colors"
                                                            >
                                                                {preset.label} {preset.value > 0 && `(${preset.value}%)`}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {results.totalCost > 0 && (
                                                <div className="bg-white rounded-lg p-4 border-2 border-indigo-200">
                                                    <h4 className="font-semibold text-gray-700 mb-3">Wyniki obliczeń:</h4>
                                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Koszty całkowite</div>
                                                            <div className="text-xl font-bold text-gray-800">
                                                                {results.totalCost.toFixed(2)} zł
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Cena sprzedaży</div>
                                                            <div className="text-xl font-bold text-green-600">
                                                                {results.sellingPrice.toFixed(2)} zł
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Zysk</div>
                                                            <div className="text-xl font-bold text-indigo-600">
                                                                {results.profit.toFixed(2)} zł
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Mnożnik</div>
                                                            <div className="text-lg font-semibold text-gray-700">
                                                                {results.multiplier.toFixed(2)}x
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Narzut</div>
                                                            <div className="text-lg font-semibold text-gray-700">
                                                                {results.markup.toFixed(2)}%
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div className="text-xs text-gray-600 mb-1">Marża rzeczywista</div>
                                                            <div className="text-lg font-semibold text-indigo-600">
                                                                {product.targetMargin}%
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="flex flex-col sm:flex-row gap-3 mt-6">
                                <button
                                    onClick={addProduct}
                                    className="flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                    </svg>
                                    Dodaj produkt
                                </button>
                                <button
                                    onClick={exportToCSV}
                                    className="flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    Eksportuj do CSV (Excel)
                                </button>
                            </div>

                            <div className="mt-8 pt-6 border-t border-gray-200">
                                <h3 className="font-semibold text-gray-700 mb-3">Wskazówki dla handlowców:</h3>
                                <ul className="space-y-2 text-sm text-gray-600">
                                    <li className="flex gap-2">
                                        <span className="text-indigo-600 font-bold">•</span>
                                        <span>Gadżety reklamowe: celuj w marżę 30-40% (mnożnik 1.43-1.67)</span>
                                    </li>
                                    <li className="flex gap-2">
                                        <span className="text-indigo-600 font-bold">•</span>
                                        <span>Produkty premium: 50% marży (mnożnik 2.0)</span>
                                    </li>
                                    <li className="flex gap-2">
                                        <span className="text-indigo-600 font-bold">•</span>
                                        <span>Odzież firmowa: 40% marży (mnożnik 1.67)</span>
                                    </li>
                                    <li className="flex gap-2">
                                        <span className="text-indigo-600 font-bold">•</span>
                                        <span>Przy dużych zamówieniach B2B dostosuj cenę dynamicznie w zależności od spadku kosztów jednostkowych</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MarginCalculator />, document.getElementById('root'));
    </script>
</body>
</html>